# æ¥å£è¯´æ˜æ–‡æ¡£

> åŸºäºå‰ç«¯å·²å¯¹æ¥çš„æ¥å£æ¢³ç†ã€‚å¦‚æœ‰åç«¯å­—æ®µå·®å¼‚ï¼Œè¯·ä»¥å®é™…è¿”å›ä¸ºå‡†ã€‚

## å…¨å±€çº¦å®š
- åŸºç¡€åœ°å€ï¼š`VITE_API_BASE_URL`ï¼ˆä¾‹å¦‚ `https://api.example.com`ï¼‰ï¼Œå‰ç«¯ä¼šå°†å„è·¯å¾„æ‹¼åœ¨å…¶åã€‚
- è®¤è¯ï¼šè‹¥æœ¬åœ° `localStorage` ä¸­å­˜åœ¨ `auth_token`ï¼Œè¯·æ±‚å¤´è‡ªåŠ¨æºå¸¦ `Authorization: Bearer <token>`ã€‚
- é»˜è®¤å¤´ï¼š`Content-Type: application/json`ã€‚
- ç»Ÿä¸€é”™è¯¯ä½“ç¤ºä¾‹ï¼š`{ "message": "é”™è¯¯æè¿°", "error": "å¯é€‰é”™è¯¯ç ", "code": "ä¸šåŠ¡ç " }`ã€‚

## ç™»å½•ä¸è´¦å·

### POST /api/login
è¯·æ±‚ä½“ï¼š
```jsonc
{
  "username": "demo",   // ç™»å½•é‚®ç®±
  "password": "123456"           // ç™»å½•å¯†ç 
}
```
å“åº”ä½“ï¼š
```jsonc
{
  "token": "jwt-or-other-token",
  "user": {
    "id": 1,
    "name": "å±•ç¤ºåç§°ï¼Œå¯é€‰",
    "email": "user@example.com",
    "bio": "ä¸ªäººç®€ä»‹ï¼Œå¯é€‰",
    "tags": ["ç”µå­", "lofi"],
    "status": "å·²æ¿€æ´»",
    "stats": {
      "generations": 12,
      "emotionDetections": 5,
      "likes": 30,
      "monthlyPlays": 120,
      "playlists": 3,
      "followers": 42
    }
  }
}
```

### POST /api/register
è¯·æ±‚ä½“ï¼š
```jsonc
{
  "email": "new@example.com",    // æ³¨å†Œé‚®ç®±
  "password": "123456",          // å¯†ç 
  "name": "New User" ,           // ç”¨æˆ·å
  "code": "4578"                 // éªŒè¯ç 
}
```
å“åº”ä½“ï¼š
```jsonc
{

}
```

### GET /api/profile
å“åº”ä½“ï¼š
```jsonc
{
  "id": 1,
  "username": "demo",
  "name": "Demo User",
  "email": "demo@example.com",
  "bio": "è¿™ä¸ªè´¦å·ç”¨äºæ¼”ç¤ºï¼Œæ”¯æŒåœ¨å‰ç«¯ç•Œé¢ç¼–è¾‘å¹¶ä¿å­˜ã€‚",
  "avatar": "ğŸµ",
  "tags": ["å·²å®å", "éŸ³ä¹åˆ›ä½œè€…"],
  "status": "å·²æ¿€æ´»",
  "stats": {
    "generations": 18,
    "emotionDetections": 6,
    "likes": 128,
    "monthlyPlays": 32,
    "playlists": 4,
    "followers": 12
  }
}
```

### PUT /api/profile
è¯·æ±‚ä½“ï¼š
```jsonc
{
  "username": "æ–°çš„å±•ç¤ºåç§°",
  "email": "new@example.com",
  "personal_profile": "æ–°çš„ä¸ªäººç®€ä»‹",
  "tags": ["ç”µå­", "lofi"]
}
```
å“åº”ä½“ï¼š
```jsonc
{
  "id": 1,
  "name": "æ–°çš„å±•ç¤ºåç§°",
  "email": "new@example.com",
  "bio": "æ–°çš„ä¸ªäººç®€ä»‹",
  "tags": ["ç”µå­", "lofi"],
  "status": "å·²æ¿€æ´»",
  "stats": {
    "generations": 12,
    "emotionDetections": 5,
    "likes": 35,
    "monthlyPlays": 130,
    "playlists": 4,
    "followers": 50
  }
}

```

### DELETE /api/account
å“åº”ä½“ï¼š
```jsonc
{
  "message": "account deleted"           // åˆ é™¤ç»“æœæè¿°
}
```

## éŸ³ä¹ç”Ÿæˆå¯¹è¯

### POST /api/dialogues/chat
è¯·æ±‚ä½“ï¼ˆå‰ç«¯å‘é€ç¤ºä¾‹ï¼‰ï¼š
```jsonc
{
  "message": "ä½ å¥½ï¼Œæ¥ä¸€é¦–æ¬¢å¿«çš„ç”µå­ä¹", // å¿…å¡«ï¼šç”¨æˆ·è¾“å…¥
  "dialogue_id": 1,                    // å¯é€‰ï¼šç»§ç»­å·²æœ‰å¯¹è¯
  "model": "default"                   // å¯é€‰ï¼šæ¨¡å‹å€¼ default|hq|fast
}
```
å“åº”ä½“ï¼ˆå­—æ®µä¸ºå…¼å®¹é›†åˆï¼Œåç«¯è¿”å›å…¶ä¸­ä»»æ„å¯è¯†åˆ«ï¼‰ï¼š
```jsonc
{
    dialogue_id=dialogue.id,
    message_id=message.id,
    user_input=message.user_input_text or "",
    reply=message.system_reply_text or "",
    message_order=message.message_order,
    dialogue_title=dialogue.title,
    created_at=message.created_at,
    music_url=f"/{gen_result.rel_path}",
    format="wav",
    
    duration_seconds=int(gen_result.duration_sec),
    music_file_id=music_file.id,
}
```

## å†å²è®°å½•

### GET /api/history
è¯·æ±‚ä½“ï¼ˆæŸ¥è¯¢å‚æ•°ç¤ºä¾‹ï¼‰ï¼š
```jsonc
{

}
```
å“åº”ä½“ï¼š
```jsonc
{
  "items": [
    {
      "id": 1,
      "title": "æŸæ¬¡ç”Ÿæˆè®°å½•",
      "type": "generate",
      "createdAt": "2024-01-01T12:00:00Z",
      "detail": "å¯¹è¯ç”ŸæˆéŸ³ä¹",
      "description": "å¯é€‰çš„è¡¥å……æè¿°"
    }
  ]
}

```

## ä½œå“ç®¡ç†

### GET /api/works
è¯·æ±‚ä½“ï¼ˆæŸ¥è¯¢å‚æ•°ç¤ºä¾‹ï¼‰ï¼š
```jsonc
{

}
```
å“åº”ä½“ï¼š
```jsonc
[
  {
    "id": 10,
    "userId": 1,
    "name": "é›¨å¤œè¡—å¤´ Â· æ…¢æ¿çˆµå£«",
    "icon": "ğŸ·",
    "meta": "çˆµå£«, æ…¢èŠ‚å¥, å¤œæ™š",
    "tags": ["çˆµå£«", "æ…¢èŠ‚å¥", "å¤œæ™š"],
    "createdAt": "2024-01-01T12:00:00Z"
  }
]

```

### POST /api/works
è¯·æ±‚ä½“ï¼š
```jsonc
{
  "title": "New Song",                  // æ ‡é¢˜
  "description": "electronic track",    // æè¿°
  "cover": "https://example.com/new-cover.png" // å°é¢
}
```
å“åº”ä½“ï¼š
```jsonc
{
  "id": 11,                             // æ–°ä½œå“ ID
  "title": "New Song",                  // æ ‡é¢˜
  "description": "electronic track",    // æè¿°
  "cover": "https://example.com/new-cover.png", // å°é¢
  "createdAt": "2024-01-02T08:00:00Z"   // åˆ›å»ºæ—¶é—´
}
```

### PUT /api/works/{id}
è¯·æ±‚ä½“ï¼š
```jsonc
{
  "title": "Song Updated",              // æ–°æ ‡é¢˜
  "description": "updated desc",        // æ–°æè¿°
  "cover": "https://example.com/newer-cover.png" // æ–°å°é¢
}
```
å“åº”ä½“ï¼š
```jsonc
{
  "id": 11,                             // ä½œå“ ID
  "title": "Song Updated",              // æ›´æ–°åæ ‡é¢˜
  "description": "updated desc",        // æ›´æ–°åæè¿°
  "cover": "https://example.com/newer-cover.png", // æ›´æ–°åå°é¢
  "updatedAt": "2024-01-03T10:00:00Z"   // æ›´æ–°æ—¶é—´
}
```

### DELETE /api/works/{id}
å“åº”ä½“ï¼š
```jsonc
{
  "message": "deleted",                 // åˆ é™¤ç»“æœ
  "id": 11                              // è¢«åˆ ä½œå“ ID
}
```
